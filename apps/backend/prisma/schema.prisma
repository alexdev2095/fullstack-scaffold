// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          String   @id @default(uuid())
  sku         String   @unique @db.VarChar(50)
  name        String   @db.VarChar(255)
  description String?  @db.Text
  price       Float
  cost        Float?
  category    String?  @db.VarChar(100)
  brand       String?  @db.VarChar(100)
  weight      Float?
  length      Float?
  width       Float?
  height      Float?
  min_stock   Int      @default(0)
  max_stock   Int?
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamptz
  updated_at  DateTime @updatedAt @db.Timestamptz

  images          ProductImage[]
  locations       Location[]
  stock_movements StockMovement[]

  @@map("products")
}

model ProductImage {
  id         String   @id @default(uuid())
  product_id String
  url        String   @db.VarChar(500)
  filename   String   @db.VarChar(255)
  is_primary Boolean  @default(false)
  order      Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamptz

  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model Warehouse {
  id            String   @id @default(uuid())
  code          String   @unique @db.VarChar(20)
  name          String   @db.VarChar(255)
  address       String?  @db.Text
  phone         String?  @db.VarChar(20)
  email         String?  @db.VarChar(100)
  capacity      Int
  used_capacity Int      @default(0)
  manager       String?  @db.VarChar(100)
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now()) @db.Timestamptz
  updated_at    DateTime @updatedAt @db.Timestamptz

  locations       Location[]
  stock_movements StockMovement[]

  @@map("warehouses")
}

model Location {
  id           String   @id @default(uuid())
  warehouse_id String
  product_id   String
  code         String   @db.VarChar(50)
  section      String   @db.VarChar(10)
  shelf        String   @db.VarChar(10)
  level        String   @db.VarChar(10)
  quantity     Int      @default(0)
  min_quantity Int      @default(0)
  max_quantity Int?
  created_at   DateTime @default(now()) @db.Timestamptz
  updated_at   DateTime @updatedAt @db.Timestamptz

  warehouse      Warehouse       @relation(fields: [warehouse_id], references: [id], onDelete: Cascade)
  product        Product         @relation(fields: [product_id], references: [id], onDelete: Cascade)
  stockMovements StockMovement[]

  @@unique([warehouse_id, section, shelf, level])
  @@map("locations")
}

model StockMovement {
  id             String       @id @default(uuid())
  product_id     String
  warehouse_id   String
  location_id    String?
  type           MovementType
  quantity       Int
  previous_stock Int
  new_stock      Int
  reason         String?      @db.VarChar(255)
  notes          String?      @db.Text
  created_by     String?      @db.VarChar(100)
  created_at     DateTime     @default(now()) @db.Timestamptz

  product   Product   @relation(fields: [product_id], references: [id])
  warehouse Warehouse @relation(fields: [warehouse_id], references: [id])
  location  Location? @relation(fields: [location_id], references: [id])

  @@map("stock_movements")
}

enum MovementType {
  ENTRADA
  SALIDA
  AJUSTE
  TRANSFERENCIA
}
